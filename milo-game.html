<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Milo's Snowball Fight! | Feeltracker Christmas Game</title>
    <meta name="description" content="Help Milo the cocker spaniel in an epic snowball fight! A fun Christmas game from Feeltracker.">
    <link rel="icon" type="image/x-icon" href="/images/favicon.ico">
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Nunito', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(180deg, #1a237e 0%, #283593 50%, #3949ab 100%);
            min-height: 100vh;
            overflow: hidden;
            touch-action: manipulation;
        }

        /* Snowfall Background */
        .snow-bg {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1;
        }

        .snow-particle {
            position: absolute;
            background: white;
            border-radius: 50%;
            opacity: 0.8;
            animation: fall linear infinite;
        }

        @keyframes fall {
            0% { transform: translateY(-10px) rotate(0deg); }
            100% { transform: translateY(100vh) rotate(360deg); }
        }

        /* Stars Background */
        .stars-bg {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 40%;
            pointer-events: none;
            z-index: 0;
            overflow: hidden;
        }

        .star {
            position: absolute;
            background: white;
            border-radius: 50%;
            animation: twinkleStar 2s ease-in-out infinite;
        }

        .star.large {
            width: 4px;
            height: 4px;
            box-shadow: 0 0 6px 2px rgba(255, 255, 255, 0.5);
        }

        .star.medium {
            width: 3px;
            height: 3px;
            box-shadow: 0 0 4px 1px rgba(255, 255, 255, 0.4);
        }

        .star.small {
            width: 2px;
            height: 2px;
            box-shadow: 0 0 3px 1px rgba(255, 255, 255, 0.3);
        }

        @keyframes twinkleStar {
            0%, 100% { opacity: 0.3; transform: scale(1); }
            50% { opacity: 1; transform: scale(1.2); }
        }

        /* Shooting Stars */
        .shooting-star {
            position: absolute;
            width: 4px;
            height: 4px;
            background: linear-gradient(45deg, #fff, transparent);
            border-radius: 50%;
            opacity: 0;
            animation: shootingStar 3s ease-out infinite;
        }

        .shooting-star::before {
            content: '';
            position: absolute;
            top: 50%;
            right: 0;
            width: 80px;
            height: 2px;
            background: linear-gradient(90deg, rgba(255,255,255,0.8), rgba(255,255,255,0.4), transparent);
            transform: translateY(-50%);
        }

        @keyframes shootingStar {
            0% {
                opacity: 0;
                transform: translateX(0) translateY(0);
            }
            10% {
                opacity: 1;
            }
            70% {
                opacity: 1;
            }
            100% {
                opacity: 0;
                transform: translateX(300px) translateY(200px);
            }
        }

        /* Game Container */
        .game-wrapper {
            position: relative;
            z-index: 10;
            width: 100%;
            height: 100vh;
            display: flex;
            flex-direction: column;
        }

        /* Header */
        .game-header {
            background: linear-gradient(135deg, #1565C0 0%, #0D47A1 100%);
            padding: 12px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 10px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.3);
        }

        .game-title {
            color: white;
            font-size: 1.3em;
            font-weight: 800;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .game-title span {
            font-size: 1.2em;
        }

        .game-stats {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
        }

        .stat {
            background: rgba(255,255,255,0.2);
            padding: 6px 14px;
            border-radius: 20px;
            color: white;
            font-weight: 700;
            font-size: 0.95em;
            backdrop-filter: blur(5px);
        }

        .stat-value {
            color: #ffeb3b;
        }

        .back-btn {
            background: rgba(255,255,255,0.2);
            border: none;
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.9em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 6px;
        }

        .back-btn:hover {
            background: rgba(255,255,255,0.3);
            transform: scale(1.05);
        }

        /* Game Arena */
        .game-arena {
            flex: 1;
            position: relative;
            background: linear-gradient(180deg,
                #87CEEB 0%,
                #B3E5FC 25%,
                #E1F5FE 50%,
                #FFFFFF 75%,
                #E8EAF6 100%);
            overflow: hidden;
            cursor: crosshair;
        }

        /* Snow Ground */
        .snow-ground {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 80px;
            background: linear-gradient(180deg, #E3F2FD 0%, #FFFFFF 100%);
            border-radius: 100% 100% 0 0 / 50px 50px 0 0;
        }

        .snow-mound {
            position: absolute;
            bottom: 0;
            background: #fff;
            border-radius: 50% 50% 0 0;
        }

        .snow-mound:nth-child(1) { left: 10%; width: 120px; height: 40px; }
        .snow-mound:nth-child(2) { left: 40%; width: 150px; height: 50px; }
        .snow-mound:nth-child(3) { right: 15%; width: 100px; height: 35px; }

        /* Christmas Trees */
        .tree {
            position: absolute;
            bottom: 60px;
            pointer-events: none;
        }

        .tree-trunk {
            width: 20px;
            height: 40px;
            background: linear-gradient(90deg, #5D4037 0%, #4E342E 50%, #5D4037 100%);
            margin: 0 auto;
            border-radius: 2px;
        }

        .tree-top {
            width: 0;
            height: 0;
            border-left: 40px solid transparent;
            border-right: 40px solid transparent;
            border-bottom: 60px solid #2E7D32;
            position: relative;
        }

        .tree-top::before {
            content: '';
            position: absolute;
            top: 20px;
            left: -35px;
            border-left: 35px solid transparent;
            border-right: 35px solid transparent;
            border-bottom: 50px solid #388E3C;
        }

        .tree-top::after {
            content: '';
            position: absolute;
            top: 35px;
            left: -30px;
            border-left: 30px solid transparent;
            border-right: 30px solid transparent;
            border-bottom: 40px solid #43A047;
        }

        .tree-snow {
            position: absolute;
            top: -5px;
            left: 50%;
            transform: translateX(-50%);
            width: 30px;
            height: 15px;
            background: white;
            border-radius: 50%;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .tree-star {
            position: absolute;
            top: -18px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 20px;
            animation: twinkle 1s ease-in-out infinite alternate;
        }

        @keyframes twinkle {
            from { opacity: 0.7; transform: translateX(-50%) scale(0.9); }
            to { opacity: 1; transform: translateX(-50%) scale(1.1); }
        }

        .tree-lights {
            position: absolute;
            top: 15px;
            left: -25px;
            width: 50px;
            height: 40px;
        }

        .tree-light {
            position: absolute;
            width: 6px;
            height: 6px;
            border-radius: 50%;
            animation: lightBlink 1.5s ease-in-out infinite;
        }

        .tree-light:nth-child(1) { background: #ff5722; left: 5px; top: 5px; animation-delay: 0s; }
        .tree-light:nth-child(2) { background: #ffeb3b; left: 25px; top: 8px; animation-delay: 0.3s; }
        .tree-light:nth-child(3) { background: #2196f3; left: 40px; top: 5px; animation-delay: 0.6s; }
        .tree-light:nth-child(4) { background: #4caf50; left: 10px; top: 25px; animation-delay: 0.9s; }
        .tree-light:nth-child(5) { background: #e91e63; left: 35px; top: 28px; animation-delay: 1.2s; }

        @keyframes lightBlink {
            0%, 100% { opacity: 1; box-shadow: 0 0 8px currentColor; }
            50% { opacity: 0.4; box-shadow: none; }
        }

        .tree:nth-child(1) { left: 3%; z-index: 5; }
        .tree:nth-child(2) { right: 5%; transform: scale(0.9); z-index: 5; }
        .tree:nth-child(3) { left: 92%; transform: scale(0.6); bottom: 65px; z-index: 5; }
        .tree:nth-child(4) { left: 15%; transform: scale(0.5); bottom: 65px; z-index: 4; }

        /* Decorative Animals */
        .penguin {
            position: absolute;
            bottom: 65px;
            width: 35px;
            height: 45px;
            z-index: 6;
            pointer-events: none;
            animation: penguinWaddle 2s ease-in-out infinite;
        }

        @keyframes penguinWaddle {
            0%, 100% { transform: rotate(-3deg); }
            50% { transform: rotate(3deg); }
        }

        .penguin-body {
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 28px;
            height: 35px;
            background: linear-gradient(90deg, #1a1a1a 0%, #333 50%, #1a1a1a 100%);
            border-radius: 50% 50% 45% 45%;
        }

        .penguin-belly {
            position: absolute;
            bottom: 2px;
            left: 50%;
            transform: translateX(-50%);
            width: 18px;
            height: 25px;
            background: #fff;
            border-radius: 50%;
        }

        .penguin-eye {
            position: absolute;
            width: 6px;
            height: 6px;
            background: #fff;
            border-radius: 50%;
            top: 8px;
        }

        .penguin-eye.left { left: 6px; }
        .penguin-eye.right { right: 6px; }

        .penguin-eye::after {
            content: '';
            position: absolute;
            top: 1px;
            left: 1px;
            width: 4px;
            height: 4px;
            background: #000;
            border-radius: 50%;
        }

        .penguin-beak {
            position: absolute;
            top: 14px;
            left: 50%;
            transform: translateX(-50%);
            width: 0;
            height: 0;
            border-left: 5px solid transparent;
            border-right: 5px solid transparent;
            border-top: 8px solid #ff9800;
        }

        .penguin-feet {
            position: absolute;
            bottom: -3px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 4px;
        }

        .penguin-foot {
            width: 10px;
            height: 5px;
            background: #ff9800;
            border-radius: 50%;
        }

        .penguin-hat {
            position: absolute;
            top: -2px;
            left: 50%;
            transform: translateX(-50%);
            width: 20px;
            height: 12px;
            background: #d32f2f;
            border-radius: 50% 50% 0 0;
        }

        .penguin-hat::after {
            content: '';
            position: absolute;
            top: -6px;
            left: 50%;
            transform: translateX(-50%);
            width: 10px;
            height: 10px;
            background: #fff;
            border-radius: 50%;
        }

        /* Robin bird */
        .robin {
            position: absolute;
            width: 25px;
            height: 20px;
            z-index: 6;
            pointer-events: none;
            animation: robinHop 1.5s ease-in-out infinite;
        }

        @keyframes robinHop {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-5px); }
        }

        .robin-body {
            position: absolute;
            bottom: 5px;
            left: 0;
            width: 20px;
            height: 14px;
            background: linear-gradient(135deg, #6d4c41 0%, #5d4037 100%);
            border-radius: 50%;
        }

        .robin-breast {
            position: absolute;
            bottom: 5px;
            left: 3px;
            width: 10px;
            height: 10px;
            background: #e53935;
            border-radius: 50%;
        }

        .robin-head {
            position: absolute;
            bottom: 12px;
            left: 12px;
            width: 12px;
            height: 10px;
            background: #5d4037;
            border-radius: 50%;
        }

        .robin-eye {
            position: absolute;
            top: 2px;
            right: 2px;
            width: 4px;
            height: 4px;
            background: #000;
            border-radius: 50%;
        }

        .robin-eye::after {
            content: '';
            position: absolute;
            top: 0;
            left: 1px;
            width: 2px;
            height: 2px;
            background: #fff;
            border-radius: 50%;
        }

        .robin-beak {
            position: absolute;
            top: 4px;
            right: -5px;
            width: 0;
            height: 0;
            border-top: 2px solid transparent;
            border-bottom: 2px solid transparent;
            border-left: 6px solid #ff9800;
        }

        .robin-tail {
            position: absolute;
            bottom: 8px;
            left: -8px;
            width: 12px;
            height: 6px;
            background: #5d4037;
            border-radius: 50% 0 0 50%;
        }

        .robin-legs {
            position: absolute;
            bottom: 0;
            left: 8px;
            display: flex;
            gap: 3px;
        }

        .robin-leg {
            width: 2px;
            height: 6px;
            background: #5d4037;
        }

        /* Milo Character */
        .milo {
            position: absolute;
            bottom: 60px;
            left: 30px;
            width: 120px;
            height: 100px;
            z-index: 50;
            transition: transform 0.1s;
        }

        .milo.throwing {
            animation: miloThrow 0.3s ease-out;
        }

        @keyframes miloThrow {
            0% { transform: translateX(0) rotate(0); }
            30% { transform: translateX(-15px) rotate(-15deg); }
            60% { transform: translateX(20px) rotate(8deg); }
            100% { transform: translateX(0) rotate(0); }
        }

        /* Milo Body Parts */
        .milo-body {
            position: relative;
            width: 100%;
            height: 100%;
        }

        .milo-torso {
            position: absolute;
            bottom: 25px;
            left: 20px;
            width: 70px;
            height: 40px;
            background: linear-gradient(135deg, #D4A574 0%, #C4956A 50%, #B8845A 100%);
            border-radius: 50% 50% 45% 45%;
            box-shadow: inset -5px -5px 15px rgba(0,0,0,0.15);
        }

        .milo-head {
            position: absolute;
            bottom: 50px;
            left: 60px;
            width: 50px;
            height: 45px;
            background: linear-gradient(135deg, #D4A574 0%, #C08050 100%);
            border-radius: 50% 50% 45% 45%;
            z-index: 2;
        }

        .milo-eye {
            position: absolute;
            width: 16px;
            height: 15px;
            background: #FFFFFF;
            border-radius: 50%;
            top: 11px;
            box-shadow: inset 0 1px 3px rgba(0,0,0,0.15), 0 1px 2px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .milo-eye.left { left: 8px; }
        .milo-eye.right { right: 8px; }

        /* Pupil - warm brown cocker spaniel eye */
        .milo-eye::before {
            content: '';
            position: absolute;
            top: 3px;
            left: 4px;
            width: 9px;
            height: 9px;
            background: radial-gradient(circle at 40% 40%, #8B5A2B 0%, #5D3A1A 50%, #3D2512 100%);
            border-radius: 50%;
            box-shadow: inset 0 -1px 2px rgba(0,0,0,0.3);
        }

        /* Eye shine/highlight */
        .milo-eye::after {
            content: '';
            position: absolute;
            top: 4px;
            left: 5px;
            width: 4px;
            height: 4px;
            background: white;
            border-radius: 50%;
            opacity: 0.9;
        }

        .milo-nose {
            position: absolute;
            top: 26px;
            left: 50%;
            transform: translateX(-50%);
            width: 14px;
            height: 10px;
            background: #1A0F0A;
            border-radius: 50% 50% 40% 40%;
        }

        .milo-tongue {
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 12px;
            height: 10px;
            background: #FF6B9D;
            border-radius: 0 0 50% 50%;
            animation: pant 0.4s ease-in-out infinite;
        }

        @keyframes pant {
            0%, 100% { height: 10px; }
            50% { height: 16px; }
        }

        .milo-ear {
            position: absolute;
            width: 22px;
            height: 50px;
            background: linear-gradient(180deg, #8B6914 0%, #6B4E0A 100%);
            border-radius: 0 0 50% 50%;
            z-index: 1;
        }

        .milo-ear.left {
            bottom: 45px;
            left: 42px;
            transform: rotate(-20deg);
            animation: earWag 1.5s ease-in-out infinite;
        }

        .milo-ear.right {
            bottom: 45px;
            left: 82px;
            transform: rotate(20deg);
            animation: earWag 1.5s ease-in-out infinite 0.3s;
        }

        @keyframes earWag {
            0%, 100% { transform: rotate(-20deg) translateY(0); }
            50% { transform: rotate(-10deg) translateY(3px); }
        }

        .milo-ear.right {
            animation-name: earWagRight;
        }

        @keyframes earWagRight {
            0%, 100% { transform: rotate(20deg) translateY(0); }
            50% { transform: rotate(10deg) translateY(3px); }
        }

        .milo-legs {
            position: absolute;
            bottom: 0;
            left: 25px;
            display: flex;
            gap: 8px;
        }

        .milo-leg {
            width: 14px;
            height: 28px;
            background: linear-gradient(180deg, #C4956A 0%, #A67B5B 100%);
            border-radius: 6px 6px 10px 10px;
        }

        .milo-tail {
            position: absolute;
            bottom: 45px;
            left: 8px;
            width: 10px;
            height: 30px;
            background: linear-gradient(180deg, #D4A574 0%, #8B6914 100%);
            border-radius: 50%;
            transform-origin: bottom center;
            animation: wagTail 0.25s ease-in-out infinite;
        }

        @keyframes wagTail {
            0%, 100% { transform: rotate(-25deg); }
            50% { transform: rotate(25deg); }
        }

        /* Milo's Accessories */
        .milo-hat {
            position: absolute;
            bottom: 90px;
            left: 65px;
            z-index: 10;
        }

        .milo-hat-base {
            width: 35px;
            height: 22px;
            background: linear-gradient(135deg, #d32f2f 0%, #b71c1c 100%);
            border-radius: 50% 50% 0 0;
            transform: rotate(-15deg);
        }

        .milo-hat-base::after {
            content: '';
            position: absolute;
            bottom: -6px;
            left: -4px;
            width: 43px;
            height: 10px;
            background: #fff;
            border-radius: 5px;
        }

        .milo-hat-pom {
            position: absolute;
            top: -10px;
            right: -10px;
            width: 16px;
            height: 16px;
            background: #fff;
            border-radius: 50%;
            animation: pomBob 0.5s ease-in-out infinite;
        }

        @keyframes pomBob {
            0%, 100% { transform: translate(0, 0); }
            50% { transform: translate(4px, -4px); }
        }

        .milo-scarf {
            position: absolute;
            bottom: 42px;
            left: 58px;
            width: 55px;
            height: 10px;
            background: repeating-linear-gradient(
                90deg,
                #d32f2f 0px,
                #d32f2f 8px,
                #fff 8px,
                #fff 16px
            );
            border-radius: 5px;
            z-index: 3;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }

        .milo-scarf::after {
            content: '';
            position: absolute;
            right: -8px;
            top: 6px;
            width: 15px;
            height: 22px;
            background: repeating-linear-gradient(
                180deg,
                #d32f2f 0px,
                #d32f2f 6px,
                #fff 6px,
                #fff 12px
            );
            border-radius: 0 0 6px 6px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.15);
        }

        /* Super wag when scoring */
        .milo.scored .milo-tail {
            animation: superWag 0.1s ease-in-out infinite;
        }

        @keyframes superWag {
            0%, 100% { transform: rotate(-40deg) scale(1.2); }
            50% { transform: rotate(40deg) scale(1.2); }
        }

        .milo.scored::after {
            content: 'üéâ';
            position: absolute;
            top: -20px;
            left: 50%;
            font-size: 24px;
            animation: celebrateEmoji 0.5s ease-out forwards;
        }

        @keyframes celebrateEmoji {
            0% { transform: translateX(-50%) translateY(0) scale(0); opacity: 1; }
            50% { transform: translateX(-50%) translateY(-20px) scale(1.5); opacity: 1; }
            100% { transform: translateX(-50%) translateY(-40px) scale(1); opacity: 0; }
        }

        /* Snowman Target */
        .snowman {
            position: absolute;
            width: 60px;
            height: 85px;
            cursor: pointer;
            z-index: 20;
            transition: transform 0.2s;
        }

        .snowman:hover {
            transform: scale(1.08);
        }

        .snowman.hit {
            animation: snowmanHit 0.5s ease-out forwards;
            pointer-events: none;
        }

        /* Fancy Snowman - worth more points! Has colorful outfit */
        .snowman.fancy .snowman-hat {
            background: linear-gradient(135deg, #9c27b0 0%, #6a1b9a 100%);
        }

        .snowman.fancy .snowman-hat::after {
            background: linear-gradient(135deg, #9c27b0 0%, #6a1b9a 100%);
        }

        .snowman.fancy .snowman-scarf {
            position: absolute;
            bottom: 52px;
            left: 50%;
            transform: translateX(-50%);
            width: 38px;
            height: 8px;
            background: repeating-linear-gradient(90deg, #e91e63 0px, #e91e63 6px, #fff 6px, #fff 12px);
            border-radius: 4px;
            z-index: 5;
        }

        .snowman.fancy .snowman-scarf::after {
            content: '';
            position: absolute;
            right: -5px;
            top: 5px;
            width: 10px;
            height: 18px;
            background: repeating-linear-gradient(180deg, #e91e63 0px, #e91e63 5px, #fff 5px, #fff 10px);
            border-radius: 0 0 4px 4px;
        }

        .snowman.fancy::before {
            content: '‚≠ê';
            position: absolute;
            top: -20px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 16px;
            animation: starBounce 0.5s ease-in-out infinite alternate;
        }

        @keyframes starBounce {
            from { transform: translateX(-50%) translateY(0); }
            to { transform: translateX(-50%) translateY(-5px); }
        }

        /* Dancing Snowman - moves side to side! */
        .snowman.dancer {
            animation: snowmanDance 0.6s ease-in-out infinite;
        }

        @keyframes snowmanDance {
            0%, 100% { transform: translateX(0) rotate(-5deg); }
            25% { transform: translateX(-8px) rotate(0deg); }
            50% { transform: translateX(0) rotate(5deg); }
            75% { transform: translateX(8px) rotate(0deg); }
        }

        .snowman.dancer .snowman-hat {
            background: linear-gradient(135deg, #4caf50 0%, #2e7d32 100%);
        }

        .snowman.dancer .snowman-hat::after {
            background: linear-gradient(135deg, #4caf50 0%, #2e7d32 100%);
        }

        /* Mini Snowman - smaller, harder to hit! */
        .snowman.mini {
            transform: scale(0.55);
            animation: miniWobble 0.8s ease-in-out infinite;
        }

        .snowman.mini:hover {
            transform: scale(0.6);
        }

        @keyframes miniWobble {
            0%, 100% { transform: scale(0.55) translateX(0); }
            25% { transform: scale(0.55) translateX(-3px); }
            75% { transform: scale(0.55) translateX(3px); }
        }

        /* SANTA BOSS - Big, takes multiple hits! */
        .snowman.santa {
            width: 100px;
            height: 140px;
            animation: santaBounce 0.8s ease-in-out infinite;
        }

        @keyframes santaBounce {
            0%, 100% { transform: translateY(0) scale(1); }
            50% { transform: translateY(-8px) scale(1.02); }
        }

        .snowman.santa .snowman-bottom {
            width: 90px;
            height: 65px;
            background: radial-gradient(circle at 30% 30%, #FFFFFF 0%, #E8E8E8 100%);
        }

        .snowman.santa .snowman-middle {
            width: 70px;
            height: 55px;
            bottom: 50px;
            background: radial-gradient(circle at 30% 30%, #FFFFFF 0%, #E8E8E8 100%);
        }

        .snowman.santa .snowman-head {
            width: 50px;
            height: 45px;
            bottom: 95px;
        }

        /* Santa's red hat */
        .snowman.santa .snowman-hat {
            bottom: 130px;
            width: 45px;
            height: 35px;
            background: linear-gradient(135deg, #d32f2f 0%, #b71c1c 100%);
            border-radius: 50% 50% 0 0;
        }

        .snowman.santa .snowman-hat::before {
            top: -10px;
            left: 35px;
            width: 20px;
            height: 20px;
            background: white;
            border-radius: 50%;
        }

        .snowman.santa .snowman-hat::after {
            bottom: -5px;
            left: -5px;
            width: 55px;
            height: 12px;
            background: white;
            border-radius: 6px;
        }

        .snowman.santa .snowman-eye {
            bottom: 118px;
            width: 6px;
            height: 7px;
        }

        .snowman.santa .snowman-eye.left { left: 35px; }
        .snowman.santa .snowman-eye.right { left: 58px; }

        .snowman.santa .snowman-nose {
            bottom: 108px;
            left: 48px;
            border-left: 15px solid #FF6B00;
            border-top: 4px solid transparent;
            border-bottom: 4px solid transparent;
        }

        .snowman.santa .snowman-smile {
            bottom: 100px;
            width: 18px;
            height: 9px;
        }

        .snowman.santa .snowman-button {
            bottom: 65px;
        }

        /* Santa's belt */
        .santa-belt {
            position: absolute;
            bottom: 58px;
            left: 50%;
            transform: translateX(-50%);
            width: 75px;
            height: 12px;
            background: #1a1a1a;
            border-radius: 3px;
            z-index: 5;
        }

        .santa-belt::after {
            content: '';
            position: absolute;
            top: 1px;
            left: 50%;
            transform: translateX(-50%);
            width: 16px;
            height: 10px;
            background: linear-gradient(135deg, #ffd700 0%, #ffb300 100%);
            border-radius: 2px;
        }

        /* Santa health bar */
        .santa-health-bar {
            position: absolute;
            top: -25px;
            left: 50%;
            transform: translateX(-50%);
            width: 80px;
            height: 10px;
            background: #333;
            border-radius: 5px;
            overflow: hidden;
            box-shadow: 0 2px 5px rgba(0,0,0,0.3);
        }

        .santa-health-fill {
            height: 100%;
            background: linear-gradient(90deg, #4CAF50 0%, #8BC34A 100%);
            transition: width 0.2s ease-out;
            border-radius: 5px;
        }

        /* Santa boss indicator */
        .snowman.santa::before {
            content: 'üéÖ BOSS!';
            position: absolute;
            top: -45px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 14px;
            font-weight: 800;
            color: #d32f2f;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.3);
            white-space: nowrap;
            animation: bossLabel 0.5s ease-in-out infinite alternate;
        }

        @keyframes bossLabel {
            from { transform: translateX(-50%) scale(1); }
            to { transform: translateX(-50%) scale(1.1); }
        }

        /* Santa hit shake */
        .snowman.santa.shaking {
            animation: santaShake 0.15s ease-in-out;
        }

        @keyframes santaShake {
            0%, 100% { transform: translateX(0) rotate(0); }
            25% { transform: translateX(-10px) rotate(-5deg); }
            75% { transform: translateX(10px) rotate(5deg); }
        }

        @keyframes snowmanHit {
            0% { transform: scale(1) rotate(0); opacity: 1; }
            25% { transform: scale(1.3) rotate(-15deg); }
            50% { transform: scale(0.9) rotate(15deg); opacity: 0.6; }
            100% { transform: scale(0) rotate(0); opacity: 0; }
        }

        .snowman-bottom {
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 55px;
            height: 40px;
            background: radial-gradient(circle at 30% 30%, #FFFFFF 0%, #E0E0E0 100%);
            border-radius: 50%;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .snowman-middle {
            position: absolute;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            width: 42px;
            height: 35px;
            background: radial-gradient(circle at 30% 30%, #FFFFFF 0%, #E0E0E0 100%);
            border-radius: 50%;
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
        }

        .snowman-head {
            position: absolute;
            bottom: 55px;
            left: 50%;
            transform: translateX(-50%);
            width: 32px;
            height: 30px;
            background: radial-gradient(circle at 35% 35%, #FFFFFF 0%, #E8E8E8 70%, #D0D0D0 100%);
            border-radius: 50%;
            box-shadow: 0 2px 8px rgba(0,0,0,0.15);
        }

        .snowman-hat {
            position: absolute;
            bottom: 78px;
            left: 50%;
            transform: translateX(-50%);
            width: 22px;
            height: 16px;
            background: linear-gradient(180deg, #2a2a2a 0%, #1A1A1A 100%);
            border-radius: 3px 3px 0 0;
        }

        .snowman-hat::before {
            content: '';
            position: absolute;
            top: 4px;
            left: 2px;
            width: 6px;
            height: 6px;
            background: #c41e3a;
            border-radius: 50%;
        }

        .snowman-hat::after {
            content: '';
            position: absolute;
            bottom: -3px;
            left: -5px;
            width: 32px;
            height: 5px;
            background: linear-gradient(180deg, #333 0%, #1A1A1A 100%);
            border-radius: 2px;
        }

        .snowman-eye {
            position: absolute;
            width: 4px;
            height: 5px;
            background: #1A1A1A;
            border-radius: 50%;
            bottom: 70px;
        }

        .snowman-eye.left { left: 22px; }
        .snowman-eye.right { left: 34px; }

        .snowman-nose {
            position: absolute;
            bottom: 65px;
            left: 30px;
            width: 0;
            height: 0;
            border-left: 10px solid #FF6B00;
            border-top: 3px solid transparent;
            border-bottom: 3px solid transparent;
        }

        .snowman-smile {
            position: absolute;
            bottom: 60px;
            left: 50%;
            transform: translateX(-50%);
            width: 12px;
            height: 6px;
            border: 2px solid #1A1A1A;
            border-top: none;
            border-radius: 0 0 12px 12px;
        }

        .snowman-button {
            position: absolute;
            width: 5px;
            height: 5px;
            background: #1A1A1A;
            border-radius: 50%;
            left: 50%;
            transform: translateX(-50%);
            bottom: 40px;
        }

        /* Snowball */
        .snowball {
            position: absolute;
            width: 24px;
            height: 24px;
            background: radial-gradient(circle at 30% 30%, #FFFFFF 0%, #D0D0D0 100%);
            border-radius: 50%;
            box-shadow: 0 3px 10px rgba(0,0,0,0.2);
            z-index: 100;
            pointer-events: none;
        }

        /* Splash Effect */
        .splash {
            position: absolute;
            width: 60px;
            height: 60px;
            pointer-events: none;
            z-index: 90;
        }

        .splash-particle {
            position: absolute;
            width: 10px;
            height: 10px;
            background: #fff;
            border-radius: 50%;
            left: 50%;
            top: 50%;
            animation: splashAnim 0.4s ease-out forwards;
        }

        @keyframes splashAnim {
            0% { transform: translate(-50%, -50%) scale(1); opacity: 1; }
            100% { transform: translate(calc(-50% + var(--x)), calc(-50% + var(--y))) scale(0); opacity: 0; }
        }

        /* Score Popup */
        .score-popup {
            position: absolute;
            font-size: 2em;
            font-weight: 800;
            color: #4CAF50;
            text-shadow: 3px 3px 6px rgba(0,0,0,0.3), -1px -1px 0 white;
            pointer-events: none;
            z-index: 200;
            animation: scoreAnim 0.8s ease-out forwards;
        }

        @keyframes scoreAnim {
            0% { transform: translateY(0) scale(1); opacity: 1; }
            100% { transform: translateY(-60px) scale(1.5); opacity: 0; }
        }

        /* Game Controls */
        .game-controls {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            text-align: center;
            z-index: 60;
        }

        .start-btn, .restart-btn {
            padding: 15px 40px;
            font-size: 1.3em;
            font-weight: 800;
            border: none;
            border-radius: 30px;
            cursor: pointer;
            transition: all 0.2s;
            font-family: 'Nunito', sans-serif;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .start-btn {
            background: linear-gradient(135deg, #4CAF50 0%, #2E7D32 100%);
            color: white;
            box-shadow: 0 6px 20px rgba(76, 175, 80, 0.5);
        }

        .restart-btn {
            background: linear-gradient(135deg, #2196F3 0%, #1565C0 100%);
            color: white;
            box-shadow: 0 6px 20px rgba(33, 150, 243, 0.5);
        }

        .start-btn:hover, .restart-btn:hover {
            transform: scale(1.08);
        }

        .start-btn:active, .restart-btn:active {
            transform: scale(0.98);
        }

        .instructions {
            color: #1565C0;
            font-weight: 600;
            margin-bottom: 15px;
            font-size: 1.1em;
            text-shadow: 1px 1px 2px rgba(255,255,255,0.8);
        }

        /* Game Over */
        .game-over {
            display: none;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(255,255,255,0.95);
            padding: 40px 60px;
            border-radius: 25px;
            text-align: center;
            box-shadow: 0 15px 50px rgba(0,0,0,0.4);
            z-index: 500;
        }

        .game-over.active {
            display: block;
            animation: popIn 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        @keyframes popIn {
            0% { transform: translate(-50%, -50%) scale(0.3); opacity: 0; }
            100% { transform: translate(-50%, -50%) scale(1); opacity: 1; }
        }

        .game-over h2 {
            color: #1565C0;
            font-size: 2.5em;
            margin: 0 0 20px 0;
        }

        .game-over .final-score {
            font-size: 3em;
            font-weight: 800;
            color: #4CAF50;
            margin: 10px 0;
        }

        .game-over .message {
            font-size: 1.3em;
            color: #666;
            margin: 15px 0 25px 0;
            font-style: italic;
        }

        /* Leaderboard */
        .leaderboard {
            margin-top: 15px;
            padding: 15px;
            background: linear-gradient(135deg, #fff9c4 0%, #fff59d 100%);
            border-radius: 15px;
            max-width: 250px;
            margin-left: auto;
            margin-right: auto;
        }

        .leaderboard h4 {
            margin: 0 0 10px 0;
            color: #f57c00;
            font-size: 1em;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .leaderboard-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .leaderboard-list li {
            display: flex;
            justify-content: space-between;
            padding: 5px 10px;
            margin: 3px 0;
            background: rgba(255,255,255,0.7);
            border-radius: 8px;
            font-size: 0.9em;
        }

        .leaderboard-list li:first-child {
            background: linear-gradient(135deg, #ffd700 0%, #ffb300 100%);
            font-weight: 700;
        }

        .leaderboard-list li:nth-child(2) {
            background: linear-gradient(135deg, #e0e0e0 0%, #bdbdbd 100%);
        }

        .leaderboard-list li:nth-child(3) {
            background: linear-gradient(135deg, #ffcc80 0%, #ff9800 100%);
        }

        .new-high-score {
            color: #4CAF50;
            font-weight: 700;
            animation: pulse 0.5s ease-in-out infinite alternate;
        }

        @keyframes pulse {
            from { transform: scale(1); }
            to { transform: scale(1.1); }
        }

        /* Mobile adjustments */
        @media (max-width: 600px) {
            .game-header {
                padding: 10px 15px;
            }

            .game-title {
                font-size: 1em;
            }

            .stat {
                padding: 5px 10px;
                font-size: 0.85em;
            }

            .milo {
                transform: scale(0.75);
                left: 10px;
                bottom: 50px;
            }

            .snowman {
                transform: scale(0.85);
            }

            .game-over {
                padding: 20px 25px;
                max-height: 85vh;
                overflow-y: auto;
            }

            .game-over h2 {
                font-size: 1.6em;
            }

            .game-over .final-score {
                font-size: 2em;
            }

            .leaderboard {
                padding: 10px;
            }
        }

        /* Fix for Android/iOS bottom nav bar cutoff */
        @supports (padding-bottom: env(safe-area-inset-bottom)) {
            .game-wrapper {
                padding-bottom: env(safe-area-inset-bottom);
            }

            .game-controls {
                padding-bottom: calc(15px + env(safe-area-inset-bottom));
            }
        }

        /* Extra padding for devices with gesture nav */
        @media (max-height: 700px) {
            .game-arena {
                height: calc(100% - 160px);
            }

            .game-controls {
                padding: 10px 15px 25px 15px;
            }

            .instructions {
                font-size: 0.9em;
                margin-bottom: 8px;
            }

            .start-btn, .restart-btn {
                padding: 10px 25px;
                font-size: 1em;
            }
        }

        /* Very small screens */
        @media (max-height: 600px) {
            .game-header {
                padding: 8px 12px;
            }

            .game-title {
                font-size: 0.9em;
            }

            .game-arena {
                height: calc(100% - 140px);
            }

            .milo {
                transform: scale(0.6);
                bottom: 40px;
            }
        }
    </style>
</head>
<body>
    <!-- Stars Background -->
    <div class="stars-bg" id="starsBg"></div>

    <!-- Snow Background -->
    <div class="snow-bg" id="snowBg"></div>

    <!-- Game Wrapper -->
    <div class="game-wrapper">
        <!-- Header -->
        <div class="game-header">
            <div class="game-title">
                <span>üêï</span> Milo's Snowball Fight!
            </div>
            <div class="game-stats">
                <div class="stat">Score: <span class="stat-value" id="score">0</span></div>
                <div class="stat">Time: <span class="stat-value" id="timer">30</span>s</div>
                <div class="stat" id="comboStat" style="display:none;">Combo: <span class="stat-value" id="combo">x1</span></div>
            </div>
            <a href="/" class="back-btn">‚Üê Back</a>
        </div>

        <!-- Game Arena -->
        <div class="game-arena" id="arena">
            <!-- Christmas Trees -->
            <div class="tree">
                <div class="tree-top">
                    <div class="tree-snow"></div>
                    <div class="tree-star">‚≠ê</div>
                    <div class="tree-lights">
                        <div class="tree-light"></div>
                        <div class="tree-light"></div>
                        <div class="tree-light"></div>
                        <div class="tree-light"></div>
                        <div class="tree-light"></div>
                    </div>
                </div>
                <div class="tree-trunk"></div>
            </div>
            <div class="tree">
                <div class="tree-top">
                    <div class="tree-snow"></div>
                    <div class="tree-star">‚≠ê</div>
                    <div class="tree-lights">
                        <div class="tree-light"></div>
                        <div class="tree-light"></div>
                        <div class="tree-light"></div>
                        <div class="tree-light"></div>
                        <div class="tree-light"></div>
                    </div>
                </div>
                <div class="tree-trunk"></div>
            </div>
            <div class="tree">
                <div class="tree-top"><div class="tree-snow"></div></div>
                <div class="tree-trunk"></div>
            </div>
            <div class="tree">
                <div class="tree-top"><div class="tree-snow"></div></div>
                <div class="tree-trunk"></div>
            </div>

            <!-- Decorative Animals -->
            <div class="penguin" style="right: 12%;">
                <div class="penguin-body">
                    <div class="penguin-belly"></div>
                    <div class="penguin-eye left"></div>
                    <div class="penguin-eye right"></div>
                    <div class="penguin-beak"></div>
                </div>
                <div class="penguin-hat"></div>
                <div class="penguin-feet">
                    <div class="penguin-foot"></div>
                    <div class="penguin-foot"></div>
                </div>
            </div>

            <div class="robin" style="left: 25%; bottom: 120px;">
                <div class="robin-tail"></div>
                <div class="robin-body"></div>
                <div class="robin-breast"></div>
                <div class="robin-head">
                    <div class="robin-eye"></div>
                    <div class="robin-beak"></div>
                </div>
                <div class="robin-legs">
                    <div class="robin-leg"></div>
                    <div class="robin-leg"></div>
                </div>
            </div>

            <!-- Snow Ground -->
            <div class="snow-ground">
                <div class="snow-mound"></div>
                <div class="snow-mound"></div>
                <div class="snow-mound"></div>
            </div>

            <!-- Milo -->
            <div class="milo" id="milo">
                <div class="milo-body">
                    <div class="milo-ear left"></div>
                    <div class="milo-ear right"></div>
                    <div class="milo-tail"></div>
                    <div class="milo-torso"></div>
                    <div class="milo-head">
                        <div class="milo-eye left"></div>
                        <div class="milo-eye right"></div>
                        <div class="milo-nose"></div>
                        <div class="milo-tongue"></div>
                    </div>
                    <div class="milo-legs">
                        <div class="milo-leg"></div>
                        <div class="milo-leg"></div>
                        <div class="milo-leg"></div>
                        <div class="milo-leg"></div>
                    </div>
                </div>
                <div class="milo-hat">
                    <div class="milo-hat-base"></div>
                    <div class="milo-hat-pom"></div>
                </div>
                <div class="milo-scarf"></div>
            </div>

            <!-- Targets Container -->
            <div id="targets"></div>

            <!-- Controls -->
            <div class="game-controls" id="controls">
                <p class="instructions">Tap to throw! Chain combos! Watch for SANTA BOSS (5 hits = 100pts!)</p>
                <button class="start-btn" id="startBtn">Start Game!</button>
                <button class="restart-btn" id="restartBtn" style="display:none;">Play Again!</button>
            </div>

            <!-- Game Over -->
            <div class="game-over" id="gameOver">
                <h2>Game Over!</h2>
                <div class="final-score" id="finalScore">0</div>
                <div class="accuracy" id="accuracy" style="font-size: 0.9em; color: #666; margin: 5px 0;"></div>
                <div class="message" id="message"></div>
                <div class="leaderboard" id="leaderboard">
                    <h4>üèÜ High Scores</h4>
                    <ol class="leaderboard-list" id="leaderboardList"></ol>
                </div>
                <button class="restart-btn" onclick="restartGame()">Play Again!</button>
            </div>
        </div>
    </div>

    <script>
        // Create stars background
        const starsBg = document.getElementById('starsBg');
        const starSizes = ['small', 'medium', 'large'];
        for (let i = 0; i < 40; i++) {
            const star = document.createElement('div');
            const size = starSizes[Math.floor(Math.random() * 3)];
            star.className = `star ${size}`;
            star.style.left = Math.random() * 100 + '%';
            star.style.top = Math.random() * 100 + '%';
            star.style.animationDelay = (Math.random() * 3) + 's';
            star.style.animationDuration = (1.5 + Math.random() * 2) + 's';
            starsBg.appendChild(star);
        }

        // Create shooting stars
        function createShootingStar() {
            const shootingStar = document.createElement('div');
            shootingStar.className = 'shooting-star';
            shootingStar.style.left = (Math.random() * 60) + '%';
            shootingStar.style.top = (Math.random() * 20) + '%';
            shootingStar.style.animationDuration = (2 + Math.random() * 2) + 's';
            starsBg.appendChild(shootingStar);

            // Remove after animation
            setTimeout(() => shootingStar.remove(), 4000);
        }

        // Spawn shooting stars periodically
        setInterval(() => {
            if (Math.random() < 0.4) { // 40% chance every interval
                createShootingStar();
            }
        }, 3000);

        // Initial shooting star
        setTimeout(createShootingStar, 1000);

        // Create snow background
        const snowBg = document.getElementById('snowBg');
        for (let i = 0; i < 50; i++) {
            const particle = document.createElement('div');
            particle.className = 'snow-particle';
            particle.style.left = Math.random() * 100 + '%';
            particle.style.width = (Math.random() * 4 + 2) + 'px';
            particle.style.height = particle.style.width;
            particle.style.animationDuration = (Math.random() * 3 + 4) + 's';
            particle.style.animationDelay = (Math.random() * 5) + 's';
            snowBg.appendChild(particle);
        }

        // Game State
        let game = {
            isPlaying: false,
            score: 0,
            time: 30,
            ammo: 20,
            throws: 0,
            hits: 0,
            combo: 0,
            comboTimer: null,
            targets: [],
            timer: null,
            spawnTimer: null,
            santaSpawned: false,
            santaDefeated: false
        };

        // Christmas Music - Deck the Halls that speeds up!
        let musicCtx = null;
        let musicPlaying = false;
        let musicOscillators = [];
        let musicSpeed = 1.0;
        let musicLoopTimeout = null;

        function startChristmasMusic() {
            if (musicPlaying) return;
            musicPlaying = true;
            musicSpeed = 1.0;

            try {
                musicCtx = new (window.AudioContext || window.webkitAudioContext)();

                // "Deck the Halls" melody
                const melody = [
                    { note: 'C6', dur: 0.375 }, { note: 'B5', dur: 0.125 }, { note: 'A5', dur: 0.25 }, { note: 'G5', dur: 0.25 },
                    { note: 'A5', dur: 0.25 }, { note: 'G5', dur: 0.25 }, { note: 'F5', dur: 0.25 }, { note: 'E5', dur: 0.25 },
                    { note: 'F5', dur: 0.25 }, { note: 'G5', dur: 0.25 }, { note: 'A5', dur: 0.25 }, { note: 'F5', dur: 0.25 },
                    { note: 'G5', dur: 0.75 }, { note: 'rest', dur: 0.25 },
                    { note: 'C6', dur: 0.375 }, { note: 'B5', dur: 0.125 }, { note: 'A5', dur: 0.25 }, { note: 'G5', dur: 0.25 },
                    { note: 'A5', dur: 0.25 }, { note: 'G5', dur: 0.25 }, { note: 'F5', dur: 0.25 }, { note: 'E5', dur: 0.25 },
                    { note: 'F5', dur: 0.25 }, { note: 'G5', dur: 0.25 }, { note: 'A5', dur: 0.25 }, { note: 'F5', dur: 0.25 },
                    { note: 'G5', dur: 0.75 }, { note: 'rest', dur: 0.25 },
                ];

                const freq = {
                    'C5': 523.25, 'D5': 587.33, 'E5': 659.25, 'F5': 698.46, 'G5': 783.99,
                    'A5': 880.00, 'B5': 987.77, 'C6': 1046.50, 'rest': 0
                };

                let t = musicCtx.currentTime;

                function playLoop() {
                    if (!musicPlaying) return;

                    const speed = musicSpeed;
                    const startT = musicCtx.currentTime;
                    t = startT;

                    melody.forEach(note => {
                        const dur = note.dur / speed;
                        if (note.note !== 'rest') {
                            const osc = musicCtx.createOscillator();
                            const gain = musicCtx.createGain();
                            osc.type = 'triangle';
                            osc.frequency.value = freq[note.note];
                            gain.gain.setValueAtTime(0.1, t);
                            gain.gain.exponentialRampToValueAtTime(0.01, t + dur * 0.85);
                            osc.connect(gain);
                            gain.connect(musicCtx.destination);
                            osc.start(t);
                            osc.stop(t + dur);
                            musicOscillators.push(osc);

                            // Octave harmony
                            const harm = musicCtx.createOscillator();
                            const hGain = musicCtx.createGain();
                            harm.type = 'sine';
                            harm.frequency.value = freq[note.note] / 2;
                            hGain.gain.setValueAtTime(0.04, t);
                            hGain.gain.exponentialRampToValueAtTime(0.01, t + dur * 0.7);
                            harm.connect(hGain);
                            hGain.connect(musicCtx.destination);
                            harm.start(t);
                            harm.stop(t + dur);
                            musicOscillators.push(harm);
                        }
                        t += dur;
                    });

                    // Light percussion
                    const loopDur = t - startT;
                    const beatInterval = 0.25 / speed;
                    for (let i = 0; i * beatInterval < loopDur; i++) {
                        const beatT = startT + i * beatInterval;
                        if (i % 2 === 0) {
                            const tick = musicCtx.createOscillator();
                            const tGain = musicCtx.createGain();
                            tick.type = 'sine';
                            tick.frequency.value = 800;
                            tGain.gain.setValueAtTime(0.03, beatT);
                            tGain.gain.exponentialRampToValueAtTime(0.001, beatT + 0.05);
                            tick.connect(tGain);
                            tGain.connect(musicCtx.destination);
                            tick.start(beatT);
                            tick.stop(beatT + 0.05);
                            musicOscillators.push(tick);
                        }
                    }

                    const loopLen = t - musicCtx.currentTime;
                    if (musicPlaying) {
                        musicLoopTimeout = setTimeout(() => {
                            playLoop();
                        }, Math.max(100, loopLen * 1000 - 50));
                    }
                }

                playLoop();
            } catch(e) {
                console.log('Music not supported');
            }
        }

        function updateMusicSpeed(timeLeft) {
            // Speed up as time runs out
            if (timeLeft <= 5) {
                musicSpeed = 2.0;
            } else if (timeLeft <= 10) {
                musicSpeed = 1.5;
            } else if (timeLeft <= 15) {
                musicSpeed = 1.25;
            } else {
                musicSpeed = 1.0;
            }
        }

        function stopChristmasMusic() {
            musicPlaying = false;
            if (musicLoopTimeout) {
                clearTimeout(musicLoopTimeout);
                musicLoopTimeout = null;
            }
            musicOscillators.forEach(o => { try { o.stop(); } catch(e) {} });
            musicOscillators = [];
            if (musicCtx) {
                musicCtx.close();
                musicCtx = null;
            }
        }

        // Dramatic sound effects
        function playHitSound(type) {
            try {
                const ctx = new (window.AudioContext || window.webkitAudioContext)();
                const now = ctx.currentTime;

                // Add dramatic impact bass for ALL hits
                const bass = ctx.createOscillator();
                const bassGain = ctx.createGain();
                bass.type = 'sine';
                bass.frequency.setValueAtTime(80, now);
                bass.frequency.exponentialRampToValueAtTime(30, now + 0.15);
                bassGain.gain.setValueAtTime(0.3, now);
                bassGain.gain.exponentialRampToValueAtTime(0.01, now + 0.2);
                bass.connect(bassGain);
                bassGain.connect(ctx.destination);
                bass.start(now);
                bass.stop(now + 0.2);

                if (type === 'fancy') {
                    // Magical explosion chime cascade
                    [1, 1.25, 1.5, 2, 2.5].forEach((mult, i) => {
                        const osc = ctx.createOscillator();
                        const gain = ctx.createGain();
                        osc.type = 'sine';
                        osc.frequency.value = 880 * mult;
                        gain.gain.setValueAtTime(0.2 / (i + 1), now + i * 0.04);
                        gain.gain.exponentialRampToValueAtTime(0.01, now + 0.4 + i * 0.04);
                        osc.connect(gain);
                        gain.connect(ctx.destination);
                        osc.start(now + i * 0.04);
                        osc.stop(now + 0.5);
                    });
                    // Add sparkle noise
                    playDramaticCrash(ctx, now, 0.15);
                } else if (type === 'dancer') {
                    // Funky explosion with wobble
                    const osc = ctx.createOscillator();
                    const gain = ctx.createGain();
                    osc.type = 'square';
                    osc.frequency.setValueAtTime(800, now);
                    osc.frequency.exponentialRampToValueAtTime(100, now + 0.2);
                    gain.gain.setValueAtTime(0.18, now);
                    gain.gain.exponentialRampToValueAtTime(0.01, now + 0.25);
                    osc.connect(gain);
                    gain.connect(ctx.destination);
                    osc.start(now);
                    osc.stop(now + 0.25);
                    playDramaticCrash(ctx, now, 0.12);
                } else if (type === 'mini') {
                    // High pitched explosion ping
                    [1200, 1600, 2000].forEach((freq, i) => {
                        const osc = ctx.createOscillator();
                        const gain = ctx.createGain();
                        osc.type = 'sine';
                        osc.frequency.value = freq;
                        gain.gain.setValueAtTime(0.15, now + i * 0.03);
                        gain.gain.exponentialRampToValueAtTime(0.01, now + 0.15 + i * 0.03);
                        osc.connect(gain);
                        gain.connect(ctx.destination);
                        osc.start(now + i * 0.03);
                        osc.stop(now + 0.2);
                    });
                    playDramaticCrash(ctx, now, 0.1);
                } else if (type === 'santa') {
                    // Epic boss hit sound - big dramatic impact
                    [200, 150, 100, 75].forEach((freq, i) => {
                        const osc = ctx.createOscillator();
                        const gain = ctx.createGain();
                        osc.type = 'sawtooth';
                        osc.frequency.value = freq;
                        gain.gain.setValueAtTime(0.15, now + i * 0.05);
                        gain.gain.exponentialRampToValueAtTime(0.01, now + 0.3 + i * 0.05);
                        osc.connect(gain);
                        gain.connect(ctx.destination);
                        osc.start(now + i * 0.05);
                        osc.stop(now + 0.4);
                    });
                    playDramaticCrash(ctx, now, 0.25);
                } else {
                    // Satisfying explosion thunk for regular
                    const osc = ctx.createOscillator();
                    const gain = ctx.createGain();
                    osc.type = 'triangle';
                    osc.frequency.setValueAtTime(500, now);
                    osc.frequency.exponentialRampToValueAtTime(100, now + 0.2);
                    gain.gain.setValueAtTime(0.25, now);
                    gain.gain.exponentialRampToValueAtTime(0.01, now + 0.25);
                    osc.connect(gain);
                    gain.connect(ctx.destination);
                    osc.start(now);
                    osc.stop(now + 0.25);
                    playDramaticCrash(ctx, now, 0.1);
                }
            } catch(e) {}
        }

        // Dramatic crash/explosion noise effect
        function playDramaticCrash(ctx, startTime, volume) {
            const bufferSize = ctx.sampleRate * 0.15;
            const buffer = ctx.createBuffer(1, bufferSize, ctx.sampleRate);
            const data = buffer.getChannelData(0);
            for (let i = 0; i < bufferSize; i++) {
                data[i] = (Math.random() * 2 - 1) * Math.pow(1 - i / bufferSize, 2);
            }
            const noise = ctx.createBufferSource();
            noise.buffer = buffer;
            const noiseGain = ctx.createGain();
            noiseGain.gain.setValueAtTime(volume, startTime);
            noiseGain.gain.exponentialRampToValueAtTime(0.01, startTime + 0.15);
            noise.connect(noiseGain);
            noiseGain.connect(ctx.destination);
            noise.start(startTime);
        }

        // Santa defeat sound - triumphant!
        function playSantaDefeatSound() {
            try {
                const ctx = new (window.AudioContext || window.webkitAudioContext)();
                const now = ctx.currentTime;
                // Triumphant fanfare
                const notes = [523.25, 659.25, 783.99, 1046.50];
                notes.forEach((freq, i) => {
                    const osc = ctx.createOscillator();
                    const gain = ctx.createGain();
                    osc.type = 'triangle';
                    osc.frequency.value = freq;
                    gain.gain.setValueAtTime(0.2, now + i * 0.1);
                    gain.gain.exponentialRampToValueAtTime(0.01, now + 0.5 + i * 0.1);
                    osc.connect(gain);
                    gain.connect(ctx.destination);
                    osc.start(now + i * 0.1);
                    osc.stop(now + 0.6 + i * 0.1);
                });
                // Big explosion
                playDramaticCrash(ctx, now + 0.3, 0.4);
            } catch(e) {}
        }

        function playComboSound(combo) {
            if (combo < 2) return;
            try {
                const ctx = new (window.AudioContext || window.webkitAudioContext)();
                const now = ctx.currentTime;
                // Rising chime based on combo level
                const baseFreq = 400 + (combo * 100);
                for (let i = 0; i < Math.min(combo, 5); i++) {
                    const osc = ctx.createOscillator();
                    const gain = ctx.createGain();
                    osc.type = 'sine';
                    osc.frequency.value = baseFreq + (i * 150);
                    gain.gain.setValueAtTime(0.08, now + i * 0.06);
                    gain.gain.exponentialRampToValueAtTime(0.01, now + 0.15 + i * 0.06);
                    osc.connect(gain);
                    gain.connect(ctx.destination);
                    osc.start(now + i * 0.06);
                    osc.stop(now + 0.25 + i * 0.06);
                }
            } catch(e) {}
        }

        const arena = document.getElementById('arena');
        const milo = document.getElementById('milo');
        const targetsEl = document.getElementById('targets');
        const startBtn = document.getElementById('startBtn');
        const restartBtn = document.getElementById('restartBtn');
        const controls = document.getElementById('controls');
        const gameOverEl = document.getElementById('gameOver');

        // Start Game
        startBtn.addEventListener('click', startGame);

        function startGame() {
            game.isPlaying = true;
            game.score = 0;
            game.time = 30;
            game.ammo = 20;
            game.throws = 0;
            game.hits = 0;
            game.combo = 0;
            game.targets = [];
            game.santaSpawned = false;
            game.santaDefeated = false;
            if (game.comboTimer) clearTimeout(game.comboTimer);

            updateUI();
            document.getElementById('comboStat').style.display = 'none';
            startBtn.style.display = 'none';
            restartBtn.style.display = 'none';
            gameOverEl.classList.remove('active');
            targetsEl.innerHTML = '';

            arena.addEventListener('click', handleClick);
            arena.addEventListener('touchstart', handleTouch, { passive: false });

            // Start the Christmas music!
            startChristmasMusic();

            // Timer
            game.timer = setInterval(() => {
                game.time--;
                document.getElementById('timer').textContent = game.time;
                updateMusicSpeed(game.time);
                if (game.time <= 0) endGame();
            }, 1000);

            // Spawn targets
            spawnTarget();
            game.spawnTimer = setInterval(spawnTarget, 1200);
        }

        function restartGame() {
            // Music keeps playing - no need to restart it
            startGame();
        }

        function handleTouch(e) {
            e.preventDefault();
            const touch = e.touches[0];
            throwAt(touch.clientX, touch.clientY);
        }

        function handleClick(e) {
            if (e.target.closest('.start-btn, .restart-btn, .game-over, .back-btn')) return;
            throwAt(e.clientX, e.clientY);
        }

        function throwAt(clientX, clientY) {
            if (!game.isPlaying || game.ammo <= 0) return;

            const rect = arena.getBoundingClientRect();
            const x = clientX - rect.left;
            const y = clientY - rect.top;

            game.ammo--;
            game.throws++;
            updateUI();

            // Animate Milo
            milo.classList.add('throwing');
            setTimeout(() => milo.classList.remove('throwing'), 300);

            // Throw snowball
            throwSnowball(x, y);

            // Check hits (returns true if hit)
            const didHit = checkHit(x, y);

            // Reset combo on miss
            if (!didHit) {
                resetCombo();
            }

            // End game early if out of ammo and no targets left
            if (game.ammo <= 0 && game.targets.length === 0) {
                setTimeout(() => {
                    if (game.isPlaying && game.ammo <= 0) {
                        endGame();
                    }
                }, 500);
            }
        }

        function resetCombo() {
            game.combo = 0;
            document.getElementById('comboStat').style.display = 'none';
            if (game.comboTimer) clearTimeout(game.comboTimer);
        }

        function increaseCombo() {
            game.combo++;
            const comboStat = document.getElementById('comboStat');
            const comboEl = document.getElementById('combo');

            if (game.combo >= 2) {
                comboStat.style.display = 'block';
                const multiplier = Math.min(game.combo, 5);
                comboEl.textContent = 'x' + multiplier;
                comboEl.style.color = game.combo >= 5 ? '#ff5722' : game.combo >= 3 ? '#ffeb3b' : '#4CAF50';
            }

            // Reset combo after 2 seconds of no hits
            if (game.comboTimer) clearTimeout(game.comboTimer);
            game.comboTimer = setTimeout(() => {
                resetCombo();
            }, 2000);
        }

        function throwSnowball(targetX, targetY) {
            const miloRect = milo.getBoundingClientRect();
            const arenaRect = arena.getBoundingClientRect();

            const startX = miloRect.right - arenaRect.left + 10;
            const startY = miloRect.top - arenaRect.top + 30;

            const snowball = document.createElement('div');
            snowball.className = 'snowball';
            snowball.style.left = startX + 'px';
            snowball.style.top = startY + 'px';
            arena.appendChild(snowball);

            const duration = 280;
            const startTime = performance.now();

            function animate(time) {
                const progress = Math.min((time - startTime) / duration, 1);
                const arcHeight = 60;

                const curX = startX + (targetX - startX) * progress;
                const curY = startY + (targetY - startY) * progress - Math.sin(progress * Math.PI) * arcHeight;

                snowball.style.left = curX + 'px';
                snowball.style.top = curY + 'px';

                if (progress < 1) {
                    requestAnimationFrame(animate);
                } else {
                    createSplash(targetX, targetY);
                    snowball.remove();
                }
            }

            requestAnimationFrame(animate);
            playSound(200, 150, 0.08);
        }

        function createSplash(x, y) {
            const splash = document.createElement('div');
            splash.className = 'splash';
            splash.style.left = (x - 30) + 'px';
            splash.style.top = (y - 30) + 'px';

            for (let i = 0; i < 8; i++) {
                const p = document.createElement('div');
                p.className = 'splash-particle';
                const angle = (i / 8) * Math.PI * 2;
                const dist = 25 + Math.random() * 20;
                p.style.setProperty('--x', Math.cos(angle) * dist + 'px');
                p.style.setProperty('--y', Math.sin(angle) * dist + 'px');
                splash.appendChild(p);
            }

            arena.appendChild(splash);
            setTimeout(() => splash.remove(), 400);
        }

        function spawnTarget() {
            if (!game.isPlaying) return;

            // Spawn Santa boss when time is 15 seconds or less and hasn't spawned yet
            if (game.time <= 15 && !game.santaSpawned) {
                spawnSanta();
                game.santaSpawned = true;
                return;
            }

            const x = 180 + Math.random() * (arena.offsetWidth - 260);
            const y = 80 + Math.random() * (arena.offsetHeight - 250);

            // Determine type: 12% fancy, 18% dancer, 20% mini, 50% regular
            const rand = Math.random();
            let type = 'regular';
            let points = 10;
            let hitRadius = 50;
            let className = 'snowman';
            let lifetime = 3500;
            let extraHTML = '';

            if (rand < 0.12) {
                type = 'fancy';
                points = 25;
                hitRadius = 50;
                className = 'snowman fancy';
                lifetime = 2500;
                extraHTML = '<div class="snowman-scarf"></div>';
            } else if (rand < 0.30) {
                type = 'dancer';
                points = 20;
                hitRadius = 45;
                className = 'snowman dancer';
                lifetime = 3000;
            } else if (rand < 0.50) {
                type = 'mini';
                points = 15;
                hitRadius = 30;
                className = 'snowman mini';
                lifetime = 3000;
            }

            const snowman = document.createElement('div');
            snowman.className = className;
            snowman.style.left = x + 'px';
            snowman.style.top = y + 'px';
            snowman.innerHTML = `
                <div class="snowman-hat"></div>
                <div class="snowman-head"></div>
                <div class="snowman-eye left"></div>
                <div class="snowman-eye right"></div>
                <div class="snowman-nose"></div>
                <div class="snowman-smile"></div>
                <div class="snowman-middle"></div>
                ${extraHTML}
                <div class="snowman-button"></div>
                <div class="snowman-bottom"></div>
            `;

            targetsEl.appendChild(snowman);

            const target = { element: snowman, x, y, width: 60, height: 85, id: Date.now(), type, points, hitRadius };
            game.targets.push(target);

            setTimeout(() => {
                if (snowman.parentNode && !snowman.classList.contains('hit')) {
                    snowman.remove();
                    game.targets = game.targets.filter(t => t.id !== target.id);
                }
            }, lifetime);
        }

        // Spawn Santa Boss - takes 5 hits, worth 100 points!
        function spawnSanta() {
            const x = arena.offsetWidth / 2 - 50;
            const y = 60 + Math.random() * (arena.offsetHeight - 280);

            const snowman = document.createElement('div');
            snowman.className = 'snowman santa';
            snowman.style.left = x + 'px';
            snowman.style.top = y + 'px';
            snowman.innerHTML = `
                <div class="santa-health-bar"><div class="santa-health-fill" style="width: 100%"></div></div>
                <div class="snowman-hat"></div>
                <div class="snowman-head"></div>
                <div class="snowman-eye left"></div>
                <div class="snowman-eye right"></div>
                <div class="snowman-nose"></div>
                <div class="snowman-smile"></div>
                <div class="snowman-middle"></div>
                <div class="santa-belt"></div>
                <div class="snowman-button"></div>
                <div class="snowman-bottom"></div>
            `;

            targetsEl.appendChild(snowman);

            const target = {
                element: snowman,
                x, y,
                width: 100,
                height: 140,
                id: Date.now(),
                type: 'santa',
                points: 100,
                hitRadius: 70,
                health: 5,
                maxHealth: 5
            };
            game.targets.push(target);

            // Santa doesn't auto-disappear - must be defeated!
        }

        function checkHit(clickX, clickY) {
            let hitSomething = false;
            const targetsToRemove = [];

            // Iterate over a copy to avoid issues with modification during iteration
            [...game.targets].forEach(target => {
                const cx = target.x + target.width / 2;
                const cy = target.y + target.height / 2;
                const dist = Math.sqrt((clickX - cx) ** 2 + (clickY - cy) ** 2);
                const hitRadius = target.hitRadius || 50;

                if (dist < hitRadius) {
                    hitSomething = true;
                    game.hits++;

                    // Handle Santa boss - takes multiple hits!
                    if (target.type === 'santa' && target.health > 1) {
                        target.health--;
                        // Update health bar
                        const healthPercent = (target.health / target.maxHealth) * 100;
                        const healthFill = target.element.querySelector('.santa-health-fill');
                        if (healthFill) {
                            healthFill.style.width = healthPercent + '%';
                            // Change color as health decreases
                            if (healthPercent <= 20) {
                                healthFill.style.background = 'linear-gradient(90deg, #f44336 0%, #e53935 100%)';
                            } else if (healthPercent <= 50) {
                                healthFill.style.background = 'linear-gradient(90deg, #ff9800 0%, #ffc107 100%)';
                            }
                        }
                        // Shake effect
                        target.element.classList.remove('shaking');
                        void target.element.offsetWidth; // Force reflow
                        target.element.classList.add('shaking');
                        setTimeout(() => target.element.classList.remove('shaking'), 150);

                        // Play santa hit sound
                        playHitSound('santa');

                        // Show damage popup
                        showScorePopup(target.x + 50, target.y + 20, `HIT! ${target.health} left`);

                        // Milo gets excited for each hit!
                        milo.classList.add('scored');
                        setTimeout(() => milo.classList.remove('scored'), 300);
                        return; // Don't remove Santa yet, just damage him
                    }

                    // Regular hit (or final Santa hit) - mark for removal
                    target.element.classList.add('hit');
                    targetsToRemove.push(target.id);

                    // Increase combo and calculate multiplier
                    increaseCombo();
                    const multiplier = Math.min(game.combo, 5);
                    const basePoints = target.points || 10;
                    const points = basePoints * multiplier;

                    game.score += points;
                    updateUI();

                    // Milo gets excited! Super tail wag!
                    milo.classList.add('scored');
                    setTimeout(() => milo.classList.remove('scored'), 600);

                    // Show points with combo indicator
                    const comboText = multiplier > 1 ? ` x${multiplier}` : '';
                    if (target.type === 'santa') {
                        showScorePopup(target.x + 50, target.y, `DEFEATED! +${points}${comboText}`);
                        game.santaDefeated = true;
                        playSantaDefeatSound();
                    } else {
                        showScorePopup(target.x + 30, target.y, `+${points}${comboText}`);
                    }

                    // Play hit sound and combo sound
                    playHitSound(target.type);
                    playComboSound(game.combo);

                    setTimeout(() => target.element.remove(), 500);
                }
            });

            // Remove hit targets after iteration is complete
            if (targetsToRemove.length > 0) {
                game.targets = game.targets.filter(t => !targetsToRemove.includes(t.id));
            }

            return hitSomething;
        }

        function showScorePopup(x, y, text = '+10') {
            const popup = document.createElement('div');
            popup.className = 'score-popup';
            popup.textContent = text;
            popup.style.left = x + 'px';
            popup.style.top = y + 'px';
            arena.appendChild(popup);
            setTimeout(() => popup.remove(), 800);
        }

        function playSound(startFreq, endFreq, volume) {
            try {
                const ctx = new (window.AudioContext || window.webkitAudioContext)();
                const osc = ctx.createOscillator();
                const gain = ctx.createGain();
                osc.type = 'sine';
                osc.frequency.setValueAtTime(startFreq, ctx.currentTime);
                osc.frequency.exponentialRampToValueAtTime(endFreq, ctx.currentTime + 0.1);
                gain.gain.setValueAtTime(volume, ctx.currentTime);
                gain.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + 0.1);
                osc.connect(gain);
                gain.connect(ctx.destination);
                osc.start();
                osc.stop(ctx.currentTime + 0.1);
            } catch(e) {}
        }

        function updateUI() {
            document.getElementById('score').textContent = game.score;
            document.getElementById('timer').textContent = game.time;
        }

        // Leaderboard functions
        function getHighScores() {
            try {
                const scores = localStorage.getItem('miloSnowballHighScores');
                return scores ? JSON.parse(scores) : [];
            } catch(e) {
                return [];
            }
        }

        function saveHighScore(score) {
            try {
                let scores = getHighScores();
                scores.push({ score, date: new Date().toLocaleDateString() });
                scores.sort((a, b) => b.score - a.score);
                scores = scores.slice(0, 5); // Keep top 5
                localStorage.setItem('miloSnowballHighScores', JSON.stringify(scores));
                return scores;
            } catch(e) {
                return [];
            }
        }

        function updateLeaderboard(currentScore) {
            const scores = saveHighScore(currentScore);
            const list = document.getElementById('leaderboardList');
            list.innerHTML = '';

            if (scores.length === 0) {
                list.innerHTML = '<li>No scores yet!</li>';
                return false;
            }

            let isNewHighScore = false;
            let foundCurrent = false;

            scores.forEach((entry, i) => {
                const li = document.createElement('li');
                const medal = i === 0 ? 'ü•á' : i === 1 ? 'ü•à' : i === 2 ? 'ü•â' : '';

                // Check if this is the current score (first match only)
                if (!foundCurrent && entry.score === currentScore) {
                    li.classList.add('new-high-score');
                    li.innerHTML = `<span>${medal} ${entry.score} pts</span><span>NEW!</span>`;
                    foundCurrent = true;
                    if (i === 0) isNewHighScore = true;
                } else {
                    li.innerHTML = `<span>${medal} ${entry.score} pts</span><span>${entry.date}</span>`;
                }
                list.appendChild(li);
            });

            return isNewHighScore;
        }

        function endGame() {
            game.isPlaying = false;
            clearInterval(game.timer);
            clearInterval(game.spawnTimer);

            // Music keeps playing! It's Christmas after all!

            arena.removeEventListener('click', handleClick);
            arena.removeEventListener('touchstart', handleTouch);

            document.getElementById('finalScore').textContent = game.score;

            // Show accuracy
            const accuracy = game.throws > 0 ? Math.round((game.hits / game.throws) * 100) : 0;
            document.getElementById('accuracy').textContent = `Accuracy: ${game.hits}/${game.throws} hits (${accuracy}%)`;

            // Update leaderboard
            const isNewHighScore = updateLeaderboard(game.score);

            let msg = '';
            if (isNewHighScore) msg = 'üéâ NEW HIGH SCORE! Milo is ecstatic! üèÜ';
            else if (game.santaDefeated && game.score >= 400) msg = 'LEGENDARY! Santa defeated with style! üèÜüéÖ';
            else if (game.santaDefeated && game.score >= 300) msg = 'AMAZING! You crushed Santa boss! üéÖüí™';
            else if (game.santaDefeated) msg = 'You defeated Santa! Milo is SO proud! üéÖ';
            else if (game.score >= 250) msg = 'Incredible combo master! üèÜ';
            else if (game.score >= 150) msg = 'Milo is SO proud of you! üêï';
            else if (game.score >= 100) msg = 'Amazing combo skills! üêï';
            else if (game.score >= 60) msg = 'Great job! Milo wags his tail! üêï';
            else if (game.score >= 30) msg = 'Keep practicing with Milo! üéØ';
            else msg = 'Milo believes in you! Try again! ‚ùÑÔ∏è';

            document.getElementById('message').textContent = msg;
            gameOverEl.classList.add('active');
        }
    </script>
</body>
</html>
